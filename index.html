<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Central de Arquivos Betta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* Estilos Gerais */
    body {
      font-family: Arial, sans-serif;
      background-color: #04394E;
      color: #fff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header {
      background-color: #4b79aa;
      width: 100%;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    header img {
      height: 50px;
      margin-right: 1rem;
    }
    header h1 {
      font-size: 1.5rem;
      margin: 0;
    }
    main {
      width: 100%;
      max-width: 1200px;
      padding: 1rem 2rem;
      box-sizing: border-box;
      text-align: center;
    }
    /* Breadcrumbs */
    .breadcrumbs {
      margin: 1rem 0;
      font-size: 0.9rem;
      text-align: center;
    }
    .breadcrumbs a {
      color: #4b79aa;
      text-decoration: none;
      margin-right: 0.5rem;
    }
    .breadcrumbs span {
      margin: 0 0.5rem;
    }
    /* Pesquisa */
    #searchContainer {
      margin-bottom: 1rem;
    }
    #searchInput {
      width: 100%;
      max-width: 400px;
      padding: 8px;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
    }
    /* Grid de Bot√µes */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      justify-items: center;
    }
    .btn-item {
      background-color: #fff;
      color: #04394E;
      border: none;
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: transform 0.1s ease;
      width: 100%;
      max-width: 250px;
    }
    .btn-item:hover {
      transform: scale(1.02);
    }
    .btn-item .icon {
      display: block;
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    /* Bot√£o Voltar */
    .back-button {
      margin-bottom: 1rem;
      display: inline-block;
      background: #4b79aa;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      color: #fff;
    }
  </style>
</head>
<body>
  <!-- Cabe√ßalho com Logo e T√≠tulo -->
  <header>
    <img src="logo.png" alt="Logo da Empresa" />
    <h1>Central de Arquivos Betta</h1>
  </header>

  <main>
    <!-- Breadcrumb de navega√ß√£o -->
    <div class="breadcrumbs" id="breadcrumbs"></div>
    <!-- Bot√£o Voltar -->
    <div class="back-button" id="backButton" style="display: none;" onclick="navegarPara(currentPath.length - 2)">‚¨ÖÔ∏è Voltar</div>
    <!-- Campo de Pesquisa -->
    <div id="searchContainer">
      <input type="text" id="searchInput" placeholder="Pesquisar manual pelo n√∫mero de s√©rie ou nome" />
    </div>
    <!-- Grid de Itens -->
    <div class="grid" id="itemsGrid"></div>
  </main>

  <script>
    // Chave da API e Pasta raiz (a pasta do Google Drive com os arquivos)
    const API_KEY = process.env.NEXT_PUBLIC_API_KEY;;
    const ROOT_FOLDER_ID = NEXT_PUBLIC_FOLDER_ID;

    let currentPath = [{ id: ROOT_FOLDER_ID, name: 'Central de Arquivos' }];
    let currentFilesData = []; // Armazena os itens atuais para pesquisa

    // Fun√ß√£o para listar itens (pastas/arquivos) de uma determinada pasta
    async function listarItens(folderId) {
      const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&key=${API_KEY}&fields=files(id,name,mimeType)`;
      const res = await fetch(url);
      const data = await res.json();
      currentFilesData = data.files;
      renderItens(currentFilesData);
      atualizarBreadcrumbs();
      // Exibe o bot√£o voltar somente se n√£o estivermos na raiz
      document.getElementById('backButton').style.display = currentPath.length > 1 ? 'inline-block' : 'none';
    }

    // Renderiza os itens como bot√µes na grid, filtrando se houver pesquisa
    function renderItens(itens) {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const grid = document.getElementById('itemsGrid');
      grid.innerHTML = '';

      itens
        .filter(item => item.name.toLowerCase().includes(searchTerm))
        .forEach(item => {
          const btn = document.createElement('button');
          btn.className = 'btn-item';

          if (item.mimeType === 'application/vnd.google-apps.folder') {
            // Se for pasta, √≠cone de pasta e clique navega para a pasta
            btn.innerHTML = `<span class="icon">üìÅ</span>${item.name}`;
            btn.onclick = () => openItem(item.id, item.name, true);
          } else {
            // Se for arquivo, √≠cone de arquivo e clique faz download
            btn.innerHTML = `<span class="icon">üìÑ</span>${item.name}`;
            btn.onclick = () => {
              window.open(`https://drive.google.com/uc?export=download&id=${item.id}`, '_blank');
            };
          }
          grid.appendChild(btn);
        });
    }

    // Atualiza o breadcrumb de navega√ß√£o
    function atualizarBreadcrumbs() {
      const container = document.getElementById('breadcrumbs');
      container.innerHTML = '';
      currentPath.forEach((item, index) => {
        if (index > 0) container.innerHTML += '<span>/</span>';
        container.innerHTML += `<a href="#" onclick="navegarPara(${index})">${item.name}</a>`;
      });
    }

    // Fun√ß√£o para abrir item: se for pasta, navega para ela
    function openItem(id, name, isFolder) {
      if (isFolder) {
        currentPath.push({ id, name });
        listarItens(id);
        document.getElementById('searchInput').value = '';
      }
    }

    // Navega para um n√≠vel espec√≠fico no breadcrumb
    function navegarPara(index) {
      currentPath = currentPath.slice(0, index + 1);
      listarItens(currentPath[index].id);
      document.getElementById('searchInput').value = '';
    }

    // Filtra os itens enquanto o usu√°rio digita
    document.getElementById('searchInput').addEventListener('input', function() {
      renderItens(currentFilesData);
    });

    // Inicia na pasta raiz
    listarItens(ROOT_FOLDER_ID);
  </script>
</body>
</html>
